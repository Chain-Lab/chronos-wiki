# 区块结构

一个区块由区块头和交易列表构成，交易除了存储在区块的交易列表中，还会在数据库中存储对应的记录。

## 区块头

在目前的设计中，区块头包含如下的字段

| 字段             | 含义             | 说明                                 |
| ---------------- | ---------------- | ------------------------------------ |
| timestamp        | 毫秒级时间戳     | 区块完成打包的时间                   |
| prev_block_hash  | 前一个区块的哈希 | 指向前一个区块的哈希，用于进行索引   |
| hash             | 区块哈希         | 当前区块的哈希，和交易列表有关       |
| hash_merkle_root | 默克尔根         | 通过交易列表生成的默克尔树的根哈希值 |
| height           | 高度             | 当前区块的高度                       |
| nonce            | 随机数           | 目前默认为空，没有使用               |

对于 timestamp，其原有的设计是区块开始打包的时间。但是在后续优化共识算法和区块选择算法的时候不便于确认区块的优先级，所以调整为区块完成打包的时间。这样，可以选取交易最多并且在规定时间内完成打包的区块作为最新的区块。

## 交易列表

由一系列的交易组成的一个列表，附加在区块头后。

对于区块结构的设计还需要再进行考虑，交易列表是可以只存储交易的哈希值而不存储交易体的，交易直接放入到数据库中便于索引，但是这样重复存储了交易数据。

有一种较为理想的方法是，在内存中存放的区块的交易列表包含了完整的交易列表，而存储到数据库中则经过处理只存储交易哈希值。

这样带来的是在载入区块时存在的I/O开销，需要根据哈希值索引到所有的交易信息放入到交易列表中。内存中存放完整的交易列表可以便于在发送区块到邻居节点时一同将所有交易传输过去。