# 广播协议

在对等网络中需要对新区块或交易进行传播，将它们发送到其他节点上。目前在 Chronos 中使用了 Gossip 协议广播交易，而新区块的广播则是参考了 Ethereum 的实现

## 区块广播协议

网络通信协议下有两种和区块相关的传输，一种是区块同步，而另外一种是区块广播。

区块广播协议用于在产生新区块或收到当前轮下的待处理区块后，将区块发送给邻居节点，它对应了[通信协议](/v1.x/Protocol/通信协议.md)中的`NEW_BLOCK`、`NEW_BLOCK_HASH`以及`GET_BLOCK`状态码

假设一个节点的邻居节点有 $m$ 个，那么每次广播区块时，传输区块给 $\sqrt{m}$ 个节点，其余的节点只发送哈希值。如果邻居节点收到哈希值后需要这个区块，就会请求拉取。

(补图)

由于这是参考了 Ethereum 的实现，所以追溯到其设计的根源。选取 $\sqrt{n}$ 个节点的依据是：如果发送区块到所有的邻居节点，这会导致广播区块的复杂度为 $O(nm)$ 。而选取 $\sqrt{n}$ 个节点进行广播，这可以将复杂度降低到 $O(n\sqrt{m})$。

该优化在 Ethereum 原来的 c++ 代码仓库中可以找到：[Blocks / transactions propagation improvements #5277](https://github.com/ethereum/aleth/issues/5277)

## 交易广播协议

